---
title: "ArgoCDä½¿ã£ã¦ã¿ãŸ"
emoji: "ğŸ‘Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["kubernetes"]
published: false
---

# ã¯ã˜ã‚ã«
sweeepæ ªå¼ä¼šç¤¾ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®é–¢ç”°ã§ã™ã€‚

ä»Šå›ã¯Kubernetesç’°å¢ƒã§CDãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã‚ˆãä½¿ã‚ã‚Œã‚‹ArgoCDã‚’è§¦ã£ã¦ã¿ãŸã®ã§ã€
ç°¡å˜ã«ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚


## æº–å‚™
ArgoCDã‚’ä½¿ã†ã«ã‚ãŸã£ã¦ä»¥ä¸‹ã®æº–å‚™ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚
- ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã‚¯ãƒ©ã‚¹ã‚¿
- ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã™ã‚‹Gitãƒªãƒã‚¸ãƒˆãƒª

ä»Šå›ã¯Minikubeä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã—ã¦ã„ãã®ã§ã€åˆã‚ã«èµ·å‹•ã—ã¦ãŠãã¾ã™ã€‚
```
$ minikube start --driver=docker
```

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã®ä½œæˆ
argocdã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚
```
$ kubectl create namespace argocd
```

ä»¥ä¸‹ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’argocdã§è¨­å®šã—ã¦ãŠãã¾ã™ã€‚
```
$ kubens argocd
```

### ArgoCDã®ãƒ‡ãƒ—ãƒ­ã‚¤
æœ¬ç•ªé‹ç”¨ã§ã¯ArgoCDã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ã®ç®¡ç†ãƒ»é‹ç”¨ã‚’è¡Œãªã£ãŸã‚Šã—ã¾ã™ãŒã€
ä»Šå›ã¯ç°¡å˜ã«ãƒªãƒ¢ãƒ¼ãƒˆã«ã‚ã‚‹ArgoCDã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ç›´æ¥ã‚¯ãƒ©ã‚¹ã‚¿ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

```
$ kubectl apply -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
```

### ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª
æ¬¡ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸArgoCDã‚’ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚

ã¾ãšåˆã‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ§ãˆã¦ãŠãã¾ã™ã€‚
```
$ kubectl get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d; echo
```

æ¬¡ã«ã€å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã‚µãƒ¼ãƒ“ã‚¹ã‚¿ã‚¤ãƒ—ã‚’LoadBalancerã«å¤‰æ›´ã—ã¾ã™ã€‚
```
$ kubectl patch svc argocd-server -p '{"spec": {"type": "LoadBalancer"}}'
```

minikubeã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ›ã‚¹ãƒˆã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```
$ minikube tunnel
```

http://localhost ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ä»¥ä¸‹ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¡Œã„ã¾ã™ã€‚
- ãƒ¦ãƒ¼ã‚¶å: admin
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: å…ˆã»ã©æ§ãˆãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰


![](/images/7afbee294aa6ce/argocd_top.png)

ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¡Œã†ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã‹ã‚‰

![](/images/7afbee294aa6ce/argocd_dashboard.png)


### ãƒªãƒã‚¸ãƒˆãƒªã®ç™»éŒ²

ArgoCDã§ã¯ç›£è¦–ã™ã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã¨ãã®ãƒ‘ã‚¹ã€ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã‚¯ãƒ©ã‚¹ã‚¿ã¨ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ãªã©ã‚’1ã¤ã®çµ„ã¿ã¨ã—ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã„ã†å˜ä½ã§ç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãšã¯ãƒªãƒã‚¸ãƒˆãƒªã‚’ç™»éŒ²ã—ã¦ã„ãã¾ã™ã€‚
User Info -> CONNECT REPO USING SSH

![](/images/7afbee294aa6ce/argocd_connect_repo.png)

ã™ã‚‹ã¨Nameã‚„Projectãªã©ã®å…¥åŠ›ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€ã¾ã ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²ã—ã¦ã„ãªã„ã®ã§ã€
ã“ã“ã§ã¯Repository URLã¨SSH private key dataã®ã¿ã‚’å…¥åŠ›ã—ã¦ã€CONNECTã‚’æŠ¼ã—ã¾ã™ã€‚

![](/images/7afbee294aa6ce/argocd_connect_repo_input.png)

:::message alert
ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’è¨­å®šã—ã¦ã„ã‚‹SSHã‚­ãƒ¼ã¯å¯¾å¿œã—ã¦ã„ãªã„ãŸã‚ã€ã‚ã‚‰ã‹ã˜ã‚ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’è§£é™¤ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
:::


### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç™»éŒ²

æ¬¡ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²ã—ã¦ã„ãã¾ã™ã€‚
Manage your applications -> NEW APP

![](/images/7afbee294aa6ce/argocd_manage_app.png)

NEW APPã‚’æŠ¼ã—ãŸå¾Œã®è¨­å®šé …ç›®ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å…¥åŠ›ã—ã¾ã™ã€‚

![](/images/7afbee294aa6ce/argocd_create_app_input_general.png)

| é …ç›® | å€¤ | èª¬æ˜ |
| ---- | ---- | ---- |
| Application Name | sample | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å |
| Project | default | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã™ã‚‹ãŸã‚ |
| SYNC POLICY | Automatic (SELF HEAL) | åŒæœŸæ–¹æ³•ï¼ˆGitã§å®šç¾©ã—ãŸãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¼·åˆ¶çš„ã«ã‚¯ãƒ©ã‚¹ã‚¿ã¸åæ˜ ã•ã›ã‚‹ï¼‰ |


![](/images/7afbee294aa6ce/argocd_create_app_input_source.png)

| é …ç›® | å€¤ | èª¬æ˜ |
| ---- | ---- | ---- |
| Repository URL | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªURL | åŒæœŸå¯¾è±¡ã®ãƒªãƒã‚¸ãƒˆãƒªURL |
| Path | fastapi/ | åŒæœŸå¯¾è±¡ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ |


![](/images/7afbee294aa6ce/argocd_create_app_input_destination.png)

| é …ç›® | å€¤ | èª¬æ˜ |
| ---- | ---- | ---- |
| Cluster URL | ArgoCDãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ | ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®ã‚¯ãƒ©ã‚¹ã‚¿URL |
| Namespace | default | ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ |

å…¥åŠ›å¾ŒCREATEã‚’æŠ¼ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚
åŒæœŸæ–¹æ³•ã‚’Automaticã«è¨­å®šã—ãŸã®ã§è‡ªå‹•çš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤ãŒé–‹å§‹ã—ã€æœ€çµ‚çš„ã«ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ã«ãªã‚Šã¾ã™ã€‚

![](/images/7afbee294aa6ce/argocd_first_app.png)


## ç•ªå¤–ç·¨

```bash
$ argocd login --insecure localhost:80
$ argocd repo add git@github.com:${USER}/${REPOSITORY_NAME}.git --ssh-private-key-path ~/.ssh/${PRIVATE_KEY}
```

argocd repo add git@github.com:yu-sekita/sample-gitops-manifests-private.git --ssh-private-key-path ~/.ssh/github_key